<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <style>
        html,
        body {
            font-size: 10px;
            padding: 0;
            margin: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .wrap {
            width: 1280px;
            height: 800px;
            display: grid;
            grid-template-columns: 3fr 2fr 5fr;
            grid-template-rows: 1fr 1fr 2fr 2fr;
            gap: 1rem;
            border: 1px solid #eeeeee;
            overflow: hidden;
        }

        .wrap>* {
            border: 1px solid #bbbbbb;
            overflow-x: hidden;
            overflow-y: scroll;
        }

        .wrap>div:nth-child(1) {
            grid-column-start: 1;
            grid-column-end: 2;
            grid-row-start: 1;
            grid-row-end: 5;
        }

        .wrap>div:nth-child(6) {
            grid-column-start: 3;
            grid-column-end: 4;
            grid-row-start: 1;
            grid-row-end: 5;
        }

        .hidden_chk {
            display: none;
        }

        .hidden_chk:checked+label {
            background-color: #f3dcdc
        }

        .list_item {
            display: grid;
            border: 1px solid #aaaadd;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        }

        .list_item:hover {
            background-color: #e8e8fc
        }

        .list_item>div {
            text-align: center;
        }

        .list_item>div:nth-child(6) {
            grid-column-start: 1;
            grid-column-end: 6;
        }



        .app_line,
        .app_files,
        .app_data,
        .app_forms {
            font-size: 16px;
        }


        .detailContentDiv {
            margin-left: 1em;
            margin-right: 1em;
            display: grid;
            grid-template-columns: 10% 15% 15% 10% 5% 10% 10% 10% 15%;
        }



        .detailcontentlast {
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid black;
        }



        .lineDivContainer {
            display: grid;
            grid-template-columns: 33% 33% 33%;
            margin: 0 1em;
        }

        .lineDiv {
            display: grid;
            grid-template-columns: 30% 70%;

        }

        .lineDiv input {
            border: none;
            width: 85%;
        }

        .lineDiv .lineDivContentfirst,
        .lineDiv .lineDivContentfirstw {
            border: 1px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgb(208, 206, 206);
        }



        .lineDiv .lineDivContent {
            border-top: 1px solid black;
            border-right: 1px solid black;
        }

        .lineDiv .lineDivContentw {
            border-top: 1px solid black;

        }

        .lineDiv .lineDivContentlast {
            border-top: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid black;
        }

        .lineDiv .lineDivContentlastw {
            border-top: 1px solid black;
            border-bottom: 1px solid black;
        }


        .appDivContent {
            border-top: 1px solid black;
            border-right: 1px solid black;
        }

        .appDivContentlast {
            border-top: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid black;
        }


        .insertbtn,
        .deletebtn {
            display: none;
        }
    </style>
</head>

<body onload="init()">
    <div class="wrap">
        <div class="app_list"></div>
        <div class="app_files"></div>
        <div class="app_line"></div>
        <div class="app_data"></div>
        <div class="app_forms"></div>
        <div class="app_preview"></div>
    </div>
    <script src="js/jquery.min.js"></script>
    <script src="js/cipher.js"></script>
    <script>
        let docList, docInfo, _server = "/system/doc", apiServer = "", storage = {}, cipher;

        cipher = { // 암호화 모듈
            "encRsa": (message) => {
                let result, rsa;
                if (message === undefined || message === null) return message;
                rsa = new RSAKey();
                rsa.setPublic(cipher.rsa.public.modulus, cipher.rsa.public.exponent);
                return btoa(rsa.encrypt(message));
            },
            "encAes": (message) => {
                let cp, result;
                cp = CryptoJS.AES.encrypt(message, CryptoJS.enc.Utf8.parse(cipher.aes.key), {
                    "iv": CryptoJS.enc.Utf8.parse(cipher.aes.iv),
                    "padding": CryptoJS.pad.Pkcs7,
                    "mode": CryptoJS.mode.CBC
                });
                result = cp.toString();
                return result;
            },
            "decAes": (message) => {
                let cp, result;
                cp = CryptoJS.AES.decrypt(message, CryptoJS.enc.Utf8.parse(cipher.aes.key), {
                    iv: CryptoJS.enc.Utf8.parse(cipher.aes.iv),
                    padding: CryptoJS.pad.Pkcs7,
                    mode: CryptoJS.mode.CBC
                });
                result = cp.toString(CryptoJS.enc.Utf8);
                return result;
            },
            "rsa": {
                "public": {
                    "modulus": undefined,
                    "exponent": undefined
                },
                "private": undefined,
                "getKey": () => {
                    let url = apiServer + "/api/user/rsa";
                    $.ajax({
                        url: url,
                        method: "get",
                        dataType: "json",
                        cache: false,
                        success: (data) => {
                            let publicKeyExponent, publicKeyModulus, aesKey, aesIv, url = apiServer + "/api/user/aes";
                            if (data.result === "ok") {
                                aesKey = [cipher.genKey(8), cipher.genKey(8), cipher.genKey(8), cipher.genKey(8)];
                                aesIv = [cipher.genKey(8), cipher.genKey(8)];
                                cipher.aes.key = aesKey[0] + aesKey[1] + aesKey[2] + aesKey[3];
                                cipher.aes.iv = aesIv[0] + aesIv[1];
                                publicKeyExponent = data.data.publicKeyExponent;
                                publicKeyModulus = data.data.publicKeyModulus;
                                cipher.rsa.public.modulus = publicKeyModulus;
                                cipher.rsa.public.exponent = publicKeyExponent;
                                sessionStorage.setItem("rsaModulus", publicKeyModulus);
                                sessionStorage.setItem("rsaExponent", publicKeyExponent);
                                sessionStorage.setItem("aesKey", cipher.aes.key);
                                sessionStorage.setItem("aesIv", cipher.aes.iv);
                                $.ajax({
                                    "url": url,
                                    "method": "post",
                                    data: cipher.encRsa(aesKey[0]) + "\n" + cipher.encRsa(aesKey[1]) + "\n" + cipher.encRsa(aesKey[2]) + "\n" + cipher.encRsa(aesKey[3]) + "\n" + cipher.encRsa(aesIv[0]) + "\n" + cipher.encRsa(aesIv[1]),
                                    contentType: "text/plain",
                                    "cache": false,
                                    success: (data) => {
                                    }
                                })
                            } else {
                                msg.set(data.msg);
                            }
                        }
                    })
                }
            },
            "aes": {
                "iv": undefined,
                "key": undefined
            },
            "genKey": (length) => {
                let x, t, result = "", src = [];
                if (isNaN(length) || length < 8) length = 32;
                for (x = 0; x < 69; x++) {
                    if (x < 10)
                        src[x] = (x + 48);
                    else if (x < 36)
                        src[x] = (x + 55);
                    else if (x < 62)
                        src[x] = (x + 61);
                    else if (x == 63)
                        src[x] = 33;
                    else if (x == 64)
                        src[x] = 43;
                    else if (x == 65)
                        src[x] = 126;
                    else
                        src[x] = (x - 31);
                }
                for (x = 0; x < length; x++) {
                    t = Math.floor((Math.random() * src.length));
                    result += String.fromCharCode(src[t])
                }
                return result;
            } // End of getKey()
        }







        function getForms() {
            let url;

            url = apiServer + "/api/gw/form";

            $.ajax({
                "url": url,
                "method": "get",
                "dataType": "json",
                "cache": false,
                success: (data) => {
                    let list;
                    if (data.result === "ok") {
                        list = cipher.decAes(data.data);
                        list = JSON.parse(list);
                        storage.form = list;
                        console.log("[getForms] Success getting employee information.");
                    } else {
                        msg.set("양식 정보를 가져오지 못했습니다.");
                    }
                }
            })
        } // End of getUserMap()









        // API 서버에서 직원 정보를 가져오는 함수
        function getUserMap() {
            let url;

            url = apiServer + "/api/user/map";

            $.ajax({
                "url": url,
                "method": "get",
                "dataType": "json",
                "cache": false,
                success: (data) => {
                    let list;

                    if (data.result === "ok") {
                        list = cipher.decAes(data.data);
                        list = JSON.parse(list);
                        storage.user = list;
                        console.log("[getUserMap] Success getting employee information.");
                    } else {
                        msg.set("직원 정보를 가져오지 못했습니다.");
                    }
                }
            })
        } // End of getUserMap()

        // API 서버에서 직원 정보를 가져오는 함수
        function getDeptMap() {
            let url;

            url = apiServer + "/api/dept/map";

            $.ajax({
                "url": url,
                "method": "get",
                "dataType": "json",
                "cache": false,
                success: (data) => {
                    let list;

                    if (data.result === "ok") {
                        list = cipher.decAes(data.data);
                        list = JSON.parse(list);
                        storage.dept = list;
                        console.log("[getDeptMap] Success getting department information.");
                    } else {
                        msg.set("부서 정보를 가져오지 못했습니다.");
                    }
                }
            })
        } // End of getDeptMap()

        // API 서버에서 고객사 정보를 가져오는 함수
        function getCustomer() {
            let url;

            url = apiServer + "/api/system/customer";

            $.ajax({
                "url": url,
                "method": "get",
                "dataType": "json",
                "cache": false,
                success: (data) => {
                    let list;

                    if (data.result === "ok") {
                        list = cipher.decAes(data.data);
                        list = JSON.parse(list);
                        storage.customer = list;
                        console.log("[getCustomer] Success getting customer information.");
                    } else {
                        msg.set("고객 정보를 가져오지 못했습니다.");
                    }
                }
            })
        } // End of getCustomer()

        // 초기화 함수
        function init() {
            getList();
            cipher.rsa.getKey()
            window.setTimeout(() => {
                getCustomer();
                getDeptMap();
                getUserMap();
                getForms();
            }, 1000);
            storage.appStatus = { "1": "임시저장", "2": "검토요청", "3": "반려", "4": "승인요청", "5": "완료" }
            storage.status = { "1": "작성중", "2": "진행중", "3": "완료" }
        } // End of init()
        function lineUp(str) { let x, r = 0; for (x in str) r += str[x].charCodeAt(); return r; }
        // 서버에서 문서 목록을 가져오는 함수
        function getList() {
            $.ajax({
                url: _server,
                method: "get",
                success: (result) => {
                    let tt = result.replace(/\n+/g, "");
                    tt = tt.replace(/\t+/g, "");
                    tt = JSON.parse(tt);
                    if (tt.result === "ok") {
                        docList = tt.data;
                        storage.docList = docList;
                        drawDocList();
                    } else {
                        console.log("[ERROR] Failure parse.");
                    }
                },
                error: () => {
                    console.log("[ERROR] Failure getting document information.");
                }
            });
        } // End of getList()

        // 개별 문서 정보를 가져오는 함수
        function getDocData(docNo) {
            $.ajax({
                url: _server + "/" + docNo,
                method: "get",
                success: (result) => {
                    let tt = result.replace(/\n+/g, "");
                    tt = tt.replace(/\t+/g, "");
                    tt = JSON.parse(tt);
                    if (tt.result === "ok") {
                        docInfo = { "files": tt.files, "appData": tt.appData, "docData": tt.docData };
                        storage.docInfo = docInfo;
                        drawClickedDetail(docInfo, docNo);
                    } else {
                        console.log("[ERROR] Failure parse.");
                    }
                },
                error: () => {
                    console.log("[ERROR] Failure getting document information.");
                }
            });
        } // End of getDocData()

        //문서 목록을 화면에 그리는 함수
        function drawDocList() {
            let html, x, doc, cnt;
            if (storage.customer == undefined || storage.user == undefined || storage.dept == undefined) {
                window.setTimeout(drawDocList, 100);
                return;
            }
            cnt = document.getElementsByClassName("app_list")[0];
            html = "";
            for (x in docList) {
                doc = docList[x];
                html += ("<input type=\"checkbox\" id=\"chk" + doc.no + "\" class=\"hidden_chk\" />");
                html += ("<label class=\"list_item\" for=\"chk" + doc.no + "\" data-no=\"" + doc.no + "\" onclick=\"clickedItem(this)\">");
                html += ("<div>" + doc.no + "</div>")
                html += ("<div>" + (new Date(doc.created)).toLocaleString().substring(2, 13).replaceAll(" ", "") + "</div>")
                html += ("<div>" + (storage.customer[doc.customer] != null ? storage.customer[doc.customer].name : doc.customer) + "</div>")
                html += ("<div>" + doc.form + "</div>")
                html += ("<div>" + doc.type + "</div>")
                html += ("<div>" + doc.title + "</div>")
                html += ("<div>" + (storage.user[doc.writer].userName) + "</div>")
                html += ("<div>" + (doc.status + " : " + storage.status[doc.status]) + "</div>")
                html += "</label>";
            }

            cnt.innerHTML = html;
        } // End of drawDocList()

        // 리스트 아이템이 클릭되면 실행되는 함수
        function clickedItem(el) {
            let docNo;
            docNo = el.dataset.no;
            getDocData(docNo);

        } // End of clickedItem()


        function drawClickedDetail(info, no) {
            
            let fileTarget = $(".app_files");
            let appTarget = $(".app_line");
            let dataTarget = $(".app_data");
            let files, appData, docData = new Array();
            let filesHtml = "";
            let appDataHtml = "";
            let docDataHtml = "";
            //docInfo = { "files": tt.files, "appData": tt.appData, "docData": tt.docData };

            let dataTitles = ["date", "customer", "product", "price", "quantity", "subTotal", "tax", "total", "remark"];
            let appTitles = ["app", "approved", "comment", "request", "status"];

            for (let i = 0; i < info.appData.length; i++) {
                appDataHtml += "<div>" + "app_" + info.appData[i].app + "</div>";
                appDataHtml += "<div>" + "approved_" + info.appData[i].approved + "</div>";
                appDataHtml += "<div>" + "comment_" + info.appData[i].comment + "</div>";
                appDataHtml += "<div>" + "request_" + info.appData[i].request + "</div>";
                appDataHtml += "<div>" + "writer_" + info.appData[i].writer + "</div>";
                appDataHtml += "<div>" + "status_" + info.appData[i].status + "</div>";
            }

            appTarget.html(appDataHtml);

            filesHtml += "<div>" + "filename_" + info.files + "</div>";


            fileTarget.html(filesHtml);

            for (let i = 0; i < info.docData.length; i++) {
                docDataHtml += "<div>" + i + "데이터 -------------"
                for (let j = 0; j < dataTitles.length; j++) {
                    docDataHtml += "<div>" + info.docData[i][dataTitles[j]] + "</div>";
                }
            }

            docDataHtml += "</div>"
            dataTarget.html(docDataHtml);


            let target = $(".app_preview");

            let typeHtml = "";


            for (let i = 0; i < info.appData.length; i++) {
                for (let j = 0; j < appTitles.length; j++) {
                    info.appData[i][appTitles[j]];
                }
            }

            for (let i = 0; i < storage.docList.length; i++) {
                if (storage.docList[i].no == no) {



                    /// 결재 타입이 지출품의서인 경우 
                    if (storage.docList[i].type == "TRS" || storage.docList[i].type == "BUY") {
                        target.html(storage.form[0].form);
                        if (storage.docList[i].type == "TRS") {
                            $("#TRS").attr("checked", true);
                        } else {
                            $("#BUY").attr("checked", true);
                        }
                        let id = storage.form[0].id;

                        ////// info title content 출력하기 
                        let docListTitle = Object.keys(storage.docList[i]);

                        for (let k = 0; k < Object.keys(storage.docList[i]).length; k++) {
                            for (let j = 0; j < docListTitle.length; j++) {
                                if (docListTitle[j] == "writer") {
                                    let num = storage.docList[i][docListTitle[j]];
                                    let name = storage.user[num].userName;
                                    $("#" + id + "_" + docListTitle[j]).val(name);
                                }
                                else if (docListTitle[j] == "created") {
                                    let created = new Date(storage.docList[i][docListTitle[j]]);
                                    let year = created.getFullYear();
                                    let month = created.getMonth() + 1;
                                    let date = created.getDate();
                                    $("#" + id + "_" + docListTitle[j]).val(year + "년" + month + "월" + date + "일");
                                } else {
                                    $("#" + id + "_" + docListTitle[j]).val(storage.docList[i][docListTitle[j]]);
                                }
                            }

                        }


                        $("#" + id + "_line").html(

                            "<div class='lineDivContainer'><div class='lineDiv'><div class='lineDivContentfirstw'><div>작 성</div></div>" +
                            "<div><div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer' value='" + $("#" + id + '_writer').val() + "'></div>" +
                            "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_approved'></div>" +
                            "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_comment'></div>" +
                            "<div class='lineDivContentlastw'><input class='inputs' type='text' id='" + id + "_writer_status'></div></div></div>" +

                            "<div class='lineDiv'><div class='lineDivContentfirst'><div >결 재</div></div>" +
                            "<div><div class='appDivContent'><input class='inputs' type='text' id='" + id + "_app'></div>" +
                            "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_approved'></div>" +
                            "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_comment'></div>" +
                            "<div class='appDivContentlast'><input class='inputs' type='text' id='" + id + "_status'></div></div></div></div>");


                        for (let i = 0; i < info.appData.length; i++) {
                            for (let j = 0; j < appTitles.length; j++) {

                                if (info.appData[i][appTitles[j]] != null) {
                                    if (appTitles[j] == 'app') {
                                        let app = storage.user[info.appData[i][appTitles[j]]].userName;
                                        $("#" + id + "_" + appTitles[j]).val(app);
                                    } else if (appTitles[j] == 'status') {
                                        let status = storage.appStatus[info.appData[i][appTitles[j]]];
                                        if (status == '승인요청' || status == '임시저장') {
                                            $("#" + id + "_" + "writer_" + appTitles[j]).val(status);
                                        } else if (status == '반려') {
                                            let request = info.appData[i].request;
                                            request = storage.user[request].userName;
                                            //본인반려 
                                            if (request == $("#" + id + "_writer").val()) {


                                                $("#" + id + "_writer_" + appTitles[j]).val(status);
                                                $("#" + id + "_" + appTitles[j]).val("");
                                                $("#" + id + "_app").val('이승우');

                                                let approved = $("#" + id + "_approved").val();
                                                $("#" + id + "_writer_approved").val(approved);
                                                $("#" + id + "_approved").val("");
                                            } else if (request == '이승우') {
                                                $("#" + id + "_app").val('이승우');
                                                $("#" + id + "_" + appTitles[j]).val(status);
                                                $("#" + id + "_writer_" + appTitles[j]).val('승인요청');
                                            }

                                        } else {
                                            $("#" + id + "_" + appTitles[j]).val(status);
                                            $("#" + id + "_writer_" + appTitles[j]).val('승인요청');
                                        }


                                    } else if (appTitles[j] == 'approved') {
                                        let approved = new Date(info.appData[i][appTitles[j]]);
                                        let year = approved.getFullYear();
                                        let month = approved.getMonth() + 1;
                                        let date = approved.getDate();

                                        $("#" + id + "_" + appTitles[j]).val(year + "년" + month + "월" + date + "일");

                                    }


                                    else {
                                        $("#" + id + "_" + appTitles[j]).val(info.appData[i][appTitles[j]]);
                                    }

                                }
                            }
                        }


                        let dataHtml = ""


                        for (let q = 0; q < Object.keys(info.docData).length; q++) {
                            dataHtml += "<div class='detailContentDiv'>"
                            for (let j = 0; j < dataTitles.length; j++) {
                                if (j == (dataTitles.length - 1)) {
                                    dataHtml += "<div id='child' class='countRow detailcontentlast'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else if (dataTitles[j] == 'date') {
                                    let date = getYmd(info.docData[q][dataTitles[j]]);
                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='date' value='" + date + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else {
                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                }
                            } dataHtml += "</div>"
                        }




                        $(".insertedDataList").html(dataHtml);



                        // 결재타입이 지출결의서인 경우 
                    } else if (storage.docList[i].type == "COST" || storage.docList[i].type == "CREDIT" ||
                        storage.docList[i].type == "PAY" || storage.docList[i].type == "TAX") {


                        target.html(storage.form[1].form)

                        if (storage.docList[i].type == "COST") {
                            $("#COST").attr("checked", true);
                        } else if (storage.docList[i].type == "CREDIT") {
                            $("#CREDIT").attr("checked", true);
                        } else if (storage.docList[i].type == "PAY") {
                            $("#PAY").attr("checked", true);
                        } else {
                            $("#TAX").attr("checked", true);
                        }
                        let id = storage.form[1].id;


                        ////// info title content 출력하기 
                        let docListTitle = Object.keys(storage.docList[i]);

                        for (let k = 0; k < Object.keys(storage.docList[i]).length; k++) {
                            for (let j = 0; j < docListTitle.length; j++) {
                                if (docListTitle[j] == "writer") {
                                    let num = storage.docList[i][docListTitle[j]];
                                    let name = storage.user[num].userName;
                                    $("#" + id + "_" + docListTitle[j]).val(name);
                                }
                                else if (docListTitle[j] == "created") {

                                    let date = getYmd(storage.docList[i][docListTitle[j]]);

                                    $("#" + id + "_" + docListTitle[j]).val(date);
                                } else {
                                    $("#" + id + "_" + docListTitle[j]).val(storage.docList[i][docListTitle[j]]);
                                }
                            }

                        }


                        if ($("#" + id + "_writer").val() == '구민주') {
                            $("#" + id + "_line").html(
                                "<div class='lineDivContainer'><div class='lineDiv'><div class='lineDivContentfirstw'><div>작 성</div></div>" +
                                "<div><div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer' value='" + $("#" + id + '_writer').val() + "'></div>" +
                                "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_approved'></div>" +
                                "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_comment'></div>" +
                                "<div class='lineDivContentlastw'><input class='inputs' type='text' id='" + id + "_writer_status'></div></div></div>" +

                                "<div class='lineDiv'><div class='lineDivContentfirst'><div >결 재</div></div>" +
                                "<div><div class='lineDivContent'><input class='inputs' type='text' id='" + id + "_app'></div>" +
                                "<div class='lineDivContent'><input class='inputs' type='text' id='" + id + "_approved'></div>" +
                                "<div class='lineDivContent'><input class='inputs' type='text' id='" + id + "_comment'></div>" +
                                "<div class='lineDivContentlast'><input class='inputs' type='text' id='" + id + "_status'></div></div></div></div>");
                        } else {

                            $("#" + id + "_line").html(


                                "<div class='lineDivContainer'><div class='lineDiv'><div class='lineDivContentfirstw'><div>작 성</div></div>" +
                                "<div><div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer' value='" + $("#" + id + '_writer').val() + "'></div>" +
                                "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_approved'></div>" +
                                "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_comment'></div>" +
                                "<div class='lineDivContentlastw'><input class='inputs' type='text' id='" + id + "_writer_status'></div></div></div>" +
                                "<div class='lineDiv'><div class='lineDivContentfirst'><div >검 토</div></div>" +
                                "<div><div class='lineDivContentw'><input type='text' id='" + id + "_examine_app' value='구민주'></div>" +
                                "<div class='lineDivContentw'><input type='text' id='" + id + "_examine_Approved'></div>" +
                                "<div class='lineDivContentw'><input type='text' id='" + id + "_examine_comment'></div>" +
                                "<div class='lineDivContentlastw'><input type='text' id='" + id + "_examine_status'></div></div></div>" +
                                "<div class='lineDiv'><div class='lineDivContentfirst'><div >결 재</div></div>" +
                                "<div><div class='appDivContent'><input class='inputs' type='text' id='" + id + "_app'></div>" +
                                "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_approved'></div>" +
                                "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_comment'></div>" +
                                "<div class='appDivContentlast'><input class='inputs' type='text' id='" + id + "_status'></div></div></div></div>"





                                // "<div class='lineDiv'><div class='lineDivContentfirst'><div >검토</div></div>" +
                                // "<div><div class='lineDivContent'><input type='text' id='" + id + "_examine_app' value='구민주'></div>" +
                                // "<div class='lineDivContent'><input type='text' id='" + id + "_examine_approved'></div>" +
                                // "<div class='lineDivContent'><input type='text' id='" + id + "_examine_comment'></div>" +
                                // "<div class='lineDivContentlast'><input type='text' id='" + id + "_examine_status'></div></div></div>" +


                                // "<div class='lineDiv'><div class='lineDivContentfirst'><div >결재</div></div>" +
                                // "<div><div class='lineDivContent'><input type='text' id='" + id + "_app'></div>" +
                                // "<div class='lineDivContent'><input type='text' id='" + id + "_approved'></div>" +
                                // "<div class='lineDivContent'><input type='text' id='" + id + "_comment'></div>" +
                                // "<div class='lineDivContentlast'><input type='text' id='" + id + "_status'></div></div></div>"
                            );
                        }




                        for (let i = 0; i < info.appData.length; i++) {
                            for (let j = 0; j < appTitles.length; j++) {

                                if (info.appData[i][appTitles[j]] != null) {
                                    if (appTitles[j] == 'app') {
                                        let app = storage.user[info.appData[i][appTitles[j]]].userName;
                                        $("#" + id + "_" + appTitles[j]).val(app);
                                    } else if (appTitles[j] == 'status') {
                                        let status = storage.appStatus[info.appData[i][appTitles[j]]];
                                        if (status == "승인요청") {
                                            $("#" + id + "_examine_" + appTitles[j]).val(status);
                                        } else if (status == "완료") {
                                            $("#" + id + "_" + appTitles[j]).val(status);
                                            $("#" + id + "_writer_" + appTitles[j]).val('검토요청');
                                            $("#" + id + "_examine_" + appTitles[j]).val('검토완료');


                                        } else if (status == '반려') {
                                            let request = storage.user[info.appData[i].request].userName
                                            if (request == $("#" + id + "_writer").val()) {
                                                alert("작성자 반려");
                                                $("#" + id + "_app").val('이승우')
                                                $("#" + id + "_writer_" + appTitles[j]).val(status);
                                                let approved = $("#" + id + "_approved").val();
                                                $("#" + id + "_writer_approved").val(approved);
                                                $("#" + id + "_approved").val("");

                                            } else if (request == '구민주') {
                                                alert("구민주 반려");
                                                $("#" + id + "_app").val('이승우')
                                                $("#" + id + "_writer_" + appTitles[j]).val('검토요청');
                                                $("#" + id + "_examine_status").val(status);
                                                let approved = $("#" + id + "_approved").val();
                                                $("#" + id + "_examine_approved").val(approved);
                                                $("#" + id + "_approved").val("");
                                                let comment = $("#" + id + "_comment").val();
                                                $("#" + id + "_examine_comment").val(comment);
                                                $("#" + id + "_comment").val("");

                                            } else {
                                                alert("대표님 반려")
                                                $("#" + id + "_app").val('이승우')
                                                $("#" + id + "_examine_status").val('검토완료');
                                                $("#" + id + "_writer_" + appTitles[j]).val('검토요청');
                                                $("#" + id + "_" + appTitles[j]).val(status);
                                            }

                                        } else if (status == '임시저장' || status == '검토요청') {
                                            $("#" + id + "_writer_" + appTitles[j]).val(status);
                                        }


                                    } else if (appTitles[j] == 'approved') {
                                        let approved = new Date(info.appData[i][appTitles[j]]);
                                        let year = approved.getFullYear();
                                        let month = approved.getMonth() + 1;
                                        let date = approved.getDate();

                                        $("#" + id + "_" + appTitles[j]).val(year + "년" + month + "월" + date + "일");

                                    } else {
                                        $("#" + id + "_" + appTitles[j]).val(info.appData[i][appTitles[j]]);
                                    }

                                }
                            }

                        }


                        let dataHtml = ""


                        for (let q = 0; q < Object.keys(info.docData).length; q++) {
                            dataHtml += "<div class='detailContentDiv'>"
                            for (let j = 0; j < dataTitles.length; j++) {
                                if (j == (dataTitles.length - 1)) {
                                    dataHtml += "<div id='child' class='countRow detailcontentlast'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else if (dataTitles[j] == 'date') {
                                    let date = getYmd(info.docData[q][dataTitles[j]]);
                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + date + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else {
                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                }

                            } dataHtml += "</div>"
                        }

                        $(".insertedDataList").html(dataHtml);





                        // 결재타입이 발주서인 경우 
                    } else if (storage.docList[i].type == "PUR") {
                        target.html(storage.form[2].form)
                        let id = storage.form[2].id;

                        ////// info title content 출력하기 
                        let docListTitle = Object.keys(storage.docList[i]);

                        for (let k = 0; k < Object.keys(storage.docList[i]).length; k++) {
                            for (let j = 0; j < docListTitle.length; j++) {
                                if (docListTitle[j] == "writer") {
                                    let num = storage.docList[i][docListTitle[j]];
                                    let name = storage.user[num].userName;
                                    $("#" + id + "_" + docListTitle[j]).val(name);
                                }
                                else if (docListTitle[j] == "created") {
                                    let created = new Date(storage.docList[i][docListTitle[j]]);
                                    let year = created.getFullYear();
                                    let month = created.getMonth() + 1;
                                    let date = created.getDate();
                                    $("#" + id + "_" + docListTitle[j]).val(year + "년" + month + "월" + date + "일");
                                } else {
                                    $("#" + id + "_" + docListTitle[j]).val(storage.docList[i][docListTitle[j]]);
                                }
                            }

                        }



                        $("#" + id + "_line").html(

                            "<div class='lineDivContainer'><div class='lineDiv'><div class='lineDivContentfirstw'><div>작 성</div></div>" +
                            "<div><div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer' value='" + $("#" + id + '_writer').val() + "'></div>" +
                            "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_approved'></div>" +
                            "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_comment'></div>" +
                            "<div class='lineDivContentlastw'><input class='inputs' type='text' id='" + id + "_writer_status'></div></div></div>" +

                            "<div class='lineDiv'><div class='lineDivContentfirst'><div >결 재</div></div>" +
                            "<div><div class='appDivContent'><input class='inputs' type='text' id='" + id + "_app'></div>" +
                            "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_approved'></div>" +
                            "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_comment'></div>" +
                            "<div class='appDivContentlast'><input class='inputs' type='text' id='" + id + "_status'></div></div></div></div>");


                        for (let i = 0; i < info.appData.length; i++) {
                            for (let j = 0; j < appTitles.length; j++) {

                                if (info.appData[i][appTitles[j]] != null) {
                                    if (appTitles[j] == 'app') {
                                        let app = storage.user[info.appData[i][appTitles[j]]].userName;
                                        $("#" + id + "_" + appTitles[j]).val(app);
                                    } else if (appTitles[j] == 'status') {
                                        let status = storage.appStatus[info.appData[i][appTitles[j]]];
                                        if (status == '승인요청' || status == '임시저장') {
                                            $("#" + id + "_" + "writer_" + appTitles[j]).val(status);
                                        } else if (status == '반려') {
                                            let request = info.appData[i].request;
                                            request = storage.user[request].userName;
                                            //본인반려 
                                            if (request == $("#" + id + "_writer").val()) {


                                                $("#" + id + "_writer_" + appTitles[j]).val(status);
                                                $("#" + id + "_" + appTitles[j]).val("");
                                                $("#" + id + "_app").val('이승우');

                                                let approved = $("#" + id + "_approved").val();
                                                $("#" + id + "_writer_approved").val(approved);
                                                $("#" + id + "_approved").val("");
                                            } else if (request == '이승우') {
                                                $("#" + id + "_app").val('이승우');
                                                $("#" + id + "_" + appTitles[j]).val(status);
                                                $("#" + id + "_writer_" + appTitles[j]).val('승인요청');
                                            }

                                        } else {
                                            $("#" + id + "_" + appTitles[j]).val(status);
                                            $("#" + id + "_writer_" + appTitles[j]).val('승인요청');
                                        }


                                    } else if (appTitles[j] == 'approved') {
                                        let approved = new Date(info.appData[i][appTitles[j]]);
                                        let year = approved.getFullYear();
                                        let month = approved.getMonth() + 1;
                                        let date = approved.getDate();

                                        $("#" + id + "_" + appTitles[j]).val(year + "년" + month + "월" + date + "일");

                                    }


                                    else {
                                        $("#" + id + "_" + appTitles[j]).val(info.appData[i][appTitles[j]]);
                                    }

                                }
                            }
                        }

                        let dataHtml = ""


                        for (let q = 0; q < Object.keys(info.docData).length; q++) {
                            dataHtml += "<div class='detailContentDiv'>"
                            for (let j = 0; j < dataTitles.length; j++) {
                                if (j == (dataTitles.length - 1)) {
                                    dataHtml += "<div id='child' class='countRow detailcontentlast'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else if (dataTitles[j] == 'date') {
                                    let date = getYmd(info.docData[q][dataTitles[j]]);


                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + date + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else {
                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                }

                            } dataHtml += "</div>"
                        }




                        $(".insertedDataList").html(dataHtml);






                        // 결재타입이 공문서인 경우 
                    } else if (storage.docList[i].type == "DIP") {
                        target.html(storage.form[3].form)
                        let id = storage.form[3].id;



                        ////// info title content 출력하기 
                        let docListTitle = Object.keys(storage.docList[i]);

                        for (let k = 0; k < Object.keys(storage.docList[i]).length; k++) {
                            for (let j = 0; j < docListTitle.length; j++) {
                                if (docListTitle[j] == "writer") {
                                    let num = storage.docList[i][docListTitle[j]];
                                    let name = storage.user[num].userName;
                                    $("#" + id + "_" + docListTitle[j]).val(name);
                                }
                                else if (docListTitle[j] == "created") {
                                    let created = new Date(storage.docList[i][docListTitle[j]]);
                                    let year = created.getFullYear();
                                    let month = created.getMonth() + 1;
                                    let date = created.getDate();
                                    $("#" + id + "_" + docListTitle[j]).val(year + "년" + month + "월" + date + "일");
                                } else {
                                    $("#" + id + "_" + docListTitle[j]).val(storage.docList[i][docListTitle[j]]);
                                }
                            }

                        }

                        $("#" + id + "_line").html(

                            "<div class='lineDivContainer'><div class='lineDiv'><div class='lineDivContentfirstw'><div>작 성</div></div>" +
                            "<div><div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer' value='" + $("#" + id + '_writer').val() + "'></div>" +
                            "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_approved'></div>" +
                            "<div class='lineDivContentw'><input class='inputs' type='text' id='" + id + "_writer_comment'></div>" +
                            "<div class='lineDivContentlastw'><input class='inputs' type='text' id='" + id + "_writer_status'></div></div></div>" +

                            "<div class='lineDiv'><div class='lineDivContentfirst'><div >결 재</div></div>" +
                            "<div><div class='appDivContent'><input class='inputs' type='text' id='" + id + "_app'></div>" +
                            "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_approved'></div>" +
                            "<div class='appDivContent'><input class='inputs' type='text' id='" + id + "_comment'></div>" +
                            "<div class='appDivContentlast'><input class='inputs' type='text' id='" + id + "_status'></div></div></div></div>");


                        for (let i = 0; i < info.appData.length; i++) {
                            for (let j = 0; j < appTitles.length; j++) {

                                if (info.appData[i][appTitles[j]] != null) {
                                    if (appTitles[j] == 'app') {
                                        let app = storage.user[info.appData[i][appTitles[j]]].userName;
                                        $("#" + id + "_" + appTitles[j]).val(app);
                                    } else if (appTitles[j] == 'status') {
                                        let status = storage.appStatus[info.appData[i][appTitles[j]]];
                                        if (status == '승인요청' || status == '임시저장') {
                                            $("#" + id + "_" + "writer_" + appTitles[j]).val(status);
                                        } else if (status == '반려') {
                                            let request = info.appData[i].request;
                                            request = storage.user[request].userName;
                                            //본인반려 
                                            if (request == $("#" + id + "_writer").val()) {
                                                $("#" + id + "_writer_" + appTitles[j]).val(status);
                                                $("#" + id + "_" + appTitles[j]).val("");
                                                $("#" + id + "_app").val('이승우');

                                                let approved = $("#" + id + "_approved").val();
                                                $("#" + id + "_writer_approved").val(approved);
                                                $("#" + id + "_approved").val("");
                                            } else if (request == '이승우') {
                                                $("#" + id + "_app").val('이승우');
                                                $("#" + id + "_" + appTitles[j]).val(status);
                                                $("#" + id + "_writer_" + appTitles[j]).val('승인요청');
                                            }

                                        } else {
                                            $("#" + id + "_" + appTitles[j]).val(status);
                                            $("#" + id + "_writer_" + appTitles[j]).val('승인요청');
                                        }


                                    } else if (appTitles[j] == 'approved') {
                                        let approved = new Date(info.appData[i][appTitles[j]]);
                                        let year = approved.getFullYear();
                                        let month = approved.getMonth() + 1;
                                        let date = approved.getDate();

                                        $("#" + id + "_" + appTitles[j]).val(year + "년" + month + "월" + date + "일");

                                    }


                                    else {
                                        $("#" + id + "_" + appTitles[j]).val(info.appData[i][appTitles[j]]);
                                    }

                                }
                            }
                        }
                        let dataHtml = ""


                        for (let q = 0; q < Object.keys(info.docData).length; q++) {
                            dataHtml += "<div class='detailContentDiv'>"
                            for (let j = 0; j < dataTitles.length; j++) {
                                if (j == (dataTitles.length - 1)) {
                                    dataHtml += "<div id='child' class='countRow detailcontentlast'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else if (dataTitles[j] == 'date') {
                                    let date = getYmd(info.docData[q][dataTitles[j]]);

                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + date + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                } else {
                                    dataHtml += "<div id='child' class='countRow detailcontent'><input class='inputs' type='text' value='" + info.docData[q][dataTitles[j]] + "' id='" + id + "_" + dataTitles[j] + "_" + q + "'></div>";
                                }

                            } dataHtml += "</div>"
                        }
                        $(".insertedDataList").html(dataHtml);

                    }


                }

            }
            $(".inputs").attr("readonly", true);
        }



        function getYmd(date) {
            let d = new Date(date);
            return d.getFullYear() + "-" + ((d.getMonth() + 1) > 9 ? (d.getMonth() + 1).toString() : "0" + (d.getMonth() + 1)) + "-" + (d.getDate() > 9 ? d.getDate().toString() : "0" + d.getDate().toString());
        }


    </script>
</body>

</html>